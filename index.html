<!DOCTYPE HTML>
<html>
	<head>
		<title>Channel metrics</title>
        	<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
          <!-- Includi i link CSS di HTML5 -->
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="homepage is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header">
					<div class="logo container">
						<div>
							<h1><a href="index.html" id="logo">Channel Metrics</a></h1><br>
							<p>discover statistics of your channel</p>
						</div>
					</div>
				</header>

			        
			<!-- Icona  -->
				<section id="main">
					<div class="container">
						<div class="row gtr-200">
							<div class="col-12">

			<!-- search -->
                			<form class="channelForm">
                    			<input id="search" type="text" placeholder="insert your channel name" required>
                    			<button id="submit">"CERCA"</button> 
                    			</form>
				</section>
				</div>
        <div class="col-12">
            <!-- footer -->                              
                <div id="disqus_thread"></div>
                <script>
                (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://project-gkqqw4dejy.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
                })();
                </script>
        </div>
		                       
		<script>
		$("#do").click(function(){
			$ajax({
   			type: "GET",
    			url: "https://youtube.googleapis.com/youtube/v3/channels",
    			data: "?part=snippet%2CcontentDetails%2Cstatistics&id=UCK8sQmJBp8GCxrOtXWBpyEA&key=AIzaSyAjvgjAILjhg4tL3e713tEm2AUr2k5d9Nc",
    			dataType:"json",
    			success: function(data){
    					console.log(data);
	    				}
				});
    </script>	
<script>
	document.getElementById('channelForm').addEventListener('submit', async (event) => {
  event.preventDefault();
  
  const channel = document.getElementById('channelInput').value;

  const response = await fetch(`/api/channel?channel=${channel}`);
  const responsePopular = await fetch(`/api/popularVideos?channel=${channel}`);

  const data = await response.json();
  const dataPopular = await responsePopular.json();

  const videos = dataPopular.videos || []; // Verifica se dataPopular.videos Ã¨ definito

  const statsChannel = document.getElementById('statschannel');

  if (response.ok) {
    // errobox nascosta
    document.getElementById('errorBox').classList.add('d-none');

    // Azzeramento dei valori delle statistiche
    document.getElementById('subscriberCount').textContent = '';
    document.getElementById('viewCount').textContent = '';
    document.getElementById('videoCount').textContent = '';
    document.getElementById('hiddenSubscriberCount').textContent = '';
    document.getElementById('country').textContent = '';
    document.getElementById('madeForKids').textContent = '';

    // Nuova assegnazione
    document.getElementById('subscriberCount').textContent = data.subscriberCount;
    document.getElementById('viewCount').textContent = data.viewCount;
    document.getElementById('videoCount').textContent = data.videoCount;
    document.getElementById('hiddenSubscriberCount').textContent = data.hiddenSubscriberCount;
    document.getElementById('country').textContent = data.country;
    document.getElementById('madeForKids').textContent = data.madeForKids;
  
    createBarChart(videos);

    statsChannel.classList.remove('d-none');
  } else {
    statsChannel.classList.add('d-none');
    document.getElementById('errorBox').classList.remove('d-none');
  }
});

function createBarChart(videos) {
  // Estrai i dati necessari per il grafico (titoli dei video e visualizzazioni)
  const labels = videos.map(video => video.title);
  const views = videos.map(video => video.viewCount);

  const existingChart = Chart.getChart("popularVideosChart");
  if (existingChart) {
    existingChart.destroy();
  }

  // Configurazione del grafico
  const chartConfig = {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Visualizzazioni',
        data: views,
        backgroundColor:['rgba(54, 162, 235, 0.5)','rgba(255, 159, 64, 0.2)', 'rgba(255, 205, 86, 0.2)','rgba(54, 162, 235, 0.2)', 'rgba(153, 102, 255, 0.2)'],
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1,
        datalabels: {
          anchor: 'end',
          align: 'end'
        }
      }]
    },
    options: {
      plugins: {
        datalabels: {
          color: '#333', // colore del testo delle etichette
          font: {
            weight: 'bold'
          },
          formatter: (value, context) => {
            return value; // visualizza il valore delle visualizzazioni come etichetta
          }
        }
      },
      responsive: true,
      plugins: {
        title: {
          display: true,
          font: {
            size: 18,
            weight: 'bold'
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Visualizzazioni'
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  };

  // Creazione del grafico a barre
  const ctx = document.getElementById('popularVideosChart').getContext('2d');
  new Chart(ctx, chartConfig);
}

 </script>


							
	<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>  
</body>
</html>
